POD-DEIM ROM Workflow

This manual outlines the typical workflow and the scripts you need to execute for generating the data and running your POD-DEIM Reduced Order Model (ROM).

Directory for Saved Bases/Matrices:All generated `.npy` files (bases, indices, singular values) are saved in the `fom_snapshots/` directory. The `ROMTimeSeries` class expects to load them from there.

Phase 1: FOM Snapshot Generation (Online)

1.  Configure `Main.py` for FOM Snapshot Run:
    - Open `Main.py`.
    - Set `ProgramModes.SimulationEngine = 'FOM'`.
    -  Define `ProgramModes.startTime` and `ProgramModes.endTime` for the desired FOM simulation period to generate snapshots.
       Ensure the snapshot saving logic in `Main.py` correctly saves all necessary data:
        - `fom_T_snapshots.npy` (nodal temperatures)
        - `fom_q_loss_pipe_snapshots.npy` (pipe heat losses)
        - `fom_rho_nodes_snapshots.npy` (nodal densities)
        - `fom_cp_nodes_snapshots.npy` (nodal specific heats)
        - 'fom_viscosity_nodes_snapshots.npy (viscosity)
2.  Run `Main.py`:
    - Execute `python Main.py` in your terminal.
    - This will run the full simulation and save the snapshot files in the `fom_snapshots/` directory.

Phase 2: Offline - Building Reduced Bases and DEIM Components

This phase is done once after generating a satisfactory set of FOM snapshots.

1.  POD for Temperature State (`T`)
    Script:`perform_pod_analysis.py`
    Action: Run `python perform_pod_analysis.py` in your terminal.
    Output:
        - `fom_snapshots/pod_U_matrix.npy`: Contains all potential POD modes.
        - `fom_snapshots/pod_singular_values.npy`: Singular values.
        - `fom_snapshots/pod_singular_value_analysis.png`: Plot to help choose `r_dim`.
    Script: `create_pod_basis.py`
    Action:
        1.  Open `create_pod_basis.py`.
        2.  Modify the `r_modes_to_keep` variable to your chosen dimension for the reduced temperature state (e.g., `1`, `2`, `3`, etc., based on the energy captured in the `.png` plot).
        3.  Run `python create_pod_basis.py` in your terminal.
    Output: `fom_snapshots/pod_Vr_basis_r{r_value}.npy`. This is the actual POD basis \(V_r\) used by the ROM.

2.  DEIM for Nonlinear Term: Pipe Heat Loss (`Q_loss_Pipe`)
    SVD Analysis Script: `perform_deim_analysis_q_loss.py` (or configure and run `perform_deim_svd_analysis.py` for this term).
    Action: Run `python perform_deim_analysis_q_loss.py` in your terminal.
    Output:
        - `fom_snapshots/deim_q_loss_U_matrix.npy`: Basis vectors for `Q_loss_Pipe`.
        -  `fom_snapshots/deim_q_loss_s_values.npy`: Singular values for `Q_loss_Pipe`.
        -  `fom_snapshots/deim_q_loss_svalue_analysis.png`: Plot to help choose `m_q_loss`.
    DEIM Point Selection Script: `select_deim_points.py`
    Action:
        1.  Open `select_deim_points.py`.
        2.  In the `if __name__ == '__main__':` block, ensure the section for "Q_loss_Pipe" is active (uncommented).
        3.  Set `m_q_loss` to your desired number of interpolation points.
        4.  Run `python select_deim_points.py` in your terminal.
    Output:
        -  `fom_snapshots/deim_q_loss_indices_m{m_value}.npy`.
        -  `fom_snapshots/deim_q_loss_proj_matrix_m{m_value}.npy`.

3.  DEIM for Nonlinear Term: Nodal Density (`rho_Nodes`)
    SVD Analysis Script:** `perform_deim_svd_analysis.py`
    Action:
        1.  Open `perform_deim_svd_analysis.py`.
        2.  In the `if __name__ == '__main__':` block, activate/uncomment the section for `rho_Nodes`. Ensure parameters are correctly set (snapshot filename, output prefix, data label).
        3.  Run `python perform_deim_svd_analysis.py` in your terminal.
    Output: `fom_snapshots/deim_rho_U_matrix.npy`, `fom_snapshots/deim_rho_s_values.npy`, `fom_snapshots/deim_rho_svalue_analysis.png`.
    - DEIM Point Selection Script: `select_deim_points.py`
    - Action:
        1.  Open `select_deim_points.py`.
        2.  Activate/uncomment the section for "rho_Nodes".
        3.  Set `m_rho` to your desired number of interpolation points.
        4.  Run `python select_deim_points.py` in your terminal.
    Output: `fom_snapshots/deim_rho_indices_m{m_value}.npy`, `fom_snapshots/deim_rho_proj_matrix_m{m_value}.npy`.

4.  DEIM for Nonlinear Term: Nodal Specific Heat (`cp_Nodes`)
    SVD Analysis Script: `perform_deim_svd_analysis.py`
    Action:
        1.  Open `perform_deim_svd_analysis.py`.
        2.  Activate/uncomment the section for `cp_Nodes`. Ensure parameters are correctly set.
        3.  Run `python perform_deim_svd_analysis.py` in your terminal.
    Output: `fom_snapshots/deim_cp_U_matrix.npy`, `fom_snapshots/deim_cp_s_values.npy`, `fom_snapshots/deim_cp_svalue_analysis.png`.
    DEIM Point Selection Script: `select_deim_points.py`
    Action:
        1.  Open `select_deim_points.py`.
        2.  Activate/uncomment the section for "cp_Nodes".
        3.  Set `m_cp` to your desired number of interpolation points.
        4.  Run `python select_deim_points.py` in your terminal.
    Output: `fom_snapshots/deim_cp_indices_m{m_value}.npy`, `fom_snapshots/deim_cp_proj_matrix_m{m_value}.npy`.


Phase 3: ROM Configuration and Execution

1.  Configure `ROMTimeSeries.py`:
       Open `ROMTimeSeries.py`.
       In the `__init__` method, ensure the parameters match the bases you generated:
        -`self.r_dim` (e.g., matches `r_modes_to_keep` from `create_pod_basis.py`).
        -`self.m_q_loss` (e.g., matches `m_q_loss` from `select_deim_points.py`).
        -`self.m_rho` (e.g., matches `m_rho` from `select_deim_points.py`).
        -`self.m_cp` (e.g., matches `m_cp` from `select_deim_points.py`).
       line 80 set: self.m_viscosity 
    (Here all modes are set to 2)

2.  Configure `Main.py` for ROM Run:
    - Open `Main.py`.
    - Set `ProgramModes.SimulationEngine = 'ROM'`.
    - Set `ProgramModes.startTime` and `ProgramModes.endTime` for your desired ROM simulation period.
    - Set TSupply values using the list: 'custom_tsupply_values' at line 102. This list will be used if ProgramModes.TsupplyMode is 'Custom'.

3.  Run `Main.py`:
    *   Execute `python Main.py` in your terminal.
    *   This will run the ROM simulation. Snapshots from the ROM run will be saved in the `rom_snapshots/` directory.

